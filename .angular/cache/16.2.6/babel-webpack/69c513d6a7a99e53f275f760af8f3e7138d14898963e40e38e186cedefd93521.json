{"ast":null,"code":"import { JwtHelperService } from '@auth0/angular-jwt';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(router, http) {\n    this.router = router;\n    this.http = http;\n    this.apiURL = 'http://localhost:9000/users';\n    this.helper = new JwtHelperService();\n    this.isloggedIn = false;\n    this.loadToken();\n  }\n  login(user) {\n    return this.http.post(this.apiURL + '/login', user, {\n      observe: 'response'\n    });\n  }\n  saveToken(jwt) {\n    localStorage.setItem('jwt', jwt);\n    this.token = jwt;\n    this.isloggedIn = true;\n  }\n  decodeJWT() {\n    if (this.token == undefined) return;\n    const decodedToken = this.helper.decodeToken(this.token);\n    this.roles = decodedToken.roles;\n    console.log(\"roles :\" + this.roles);\n    this.loggedUser = decodedToken.sub;\n  }\n  getToken() {\n    return this.token;\n  }\n  logout() {\n    this.loggedUser = undefined;\n    this.roles = undefined;\n    this.token = undefined;\n    this.isloggedIn = false;\n    localStorage.removeItem('jwt');\n    this.router.navigate(['/login']);\n  }\n  loadToken() {\n    this.token = localStorage.getItem('jwt');\n    this.decodeJWT();\n  }\n  isTokenExpired() {\n    return this.helper.isTokenExpired(this.token);\n  }\n  /*\n   SignIn(user: User): Boolean {\n     let validUser: Boolean = false;\n     this.users.forEach((curUser) => {\n       if (user.username == curUser.username && user.password == curUser.password) {\n         validUser = true;\n         this.loggedUser = curUser.username;\n         this.isloggedIn = true;\n         this.roles = curUser.roles;\n         localStorage.setItem('loggedUser', this.loggedUser);\n         localStorage.setItem('isloggedIn', String(this.isloggedIn));\n       }\n     });\n   return validUser;\n  }\n  */\n  isAdmin() {\n    if (!this.roles) return false;\n    return this.roles.indexOf('ADMIN') >= 0;\n  }\n  setLoggedUserFromLocalStorage(login) {\n    this.loggedUser = login;\n    this.isloggedIn = true;\n    //this.getUserRoles(login);\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["JwtHelperService","AuthService","constructor","router","http","apiURL","helper","isloggedIn","loadToken","login","user","post","observe","saveToken","jwt","localStorage","setItem","token","decodeJWT","undefined","decodedToken","decodeToken","roles","console","log","loggedUser","sub","getToken","logout","removeItem","navigate","getItem","isTokenExpired","isAdmin","indexOf","setLoggedUserFromLocalStorage","_","i0","ɵɵinject","i1","Router","i2","HttpClient","_2","factory","ɵfac","providedIn"],"sources":["D:\\2éme annéé\\s1\\angular\\bibliotheque\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { User } from '../model/User.model';\nimport { Router } from '@angular/router';\nimport { HttpClient } from '@angular/common/http';\nimport { JwtHelperService } from '@auth0/angular-jwt';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n\n  apiURL: string = 'http://localhost:9000/users';\n  token!: string;\n  private helper = new JwtHelperService();\n\n\n  /*\n  users: User[] = [{\"username\":\"admin\",\"password\":\"123\",\"roles\":['ADMIN']},\n                  {\"username\":\"Tayssir\",\"password\":\"123\",\"roles\":['USER']} ];\n  */\n  public loggedUser!: string;\n  public isloggedIn: Boolean = false;\n  public roles!: string[];\n\n  constructor(private router: Router, private http: HttpClient) {\n    this.loadToken();\n  }\n\n  login(user: User) {\n    return this.http.post<User>(this.apiURL + '/login', user, { observe: 'response' });\n  }\n  saveToken(jwt: string) {\n\n    localStorage.setItem('jwt', jwt);\n    this.token = jwt;\n    this.isloggedIn = true;\n  }\n\n  decodeJWT() {\n    if (this.token == undefined)\n      return;\n    const decodedToken = this.helper.decodeToken(this.token);\n    this.roles = decodedToken.roles;\n    console.log(\"roles :\"+this.roles);\n    this.loggedUser = decodedToken.sub;\n  }\n\n  getToken(): string {\n    return this.token;\n  }\n\n  logout() {\n    this.loggedUser = undefined!;\n    this.roles = undefined!;\n    this.token = undefined!;\n    this.isloggedIn = false;\n    localStorage.removeItem('jwt');\n    this.router.navigate(['/login']);\n  }\n\n  loadToken() {\n    this.token = localStorage.getItem('jwt')!;\n    this.decodeJWT();\n  }\n  isTokenExpired(): Boolean {\n    return this.helper.isTokenExpired(this.token);\n  }\n  \n  /*\n   SignIn(user: User): Boolean {\n     let validUser: Boolean = false;\n     this.users.forEach((curUser) => {\n       if (user.username == curUser.username && user.password == curUser.password) {\n         validUser = true;\n         this.loggedUser = curUser.username;\n         this.isloggedIn = true;\n         this.roles = curUser.roles;\n         localStorage.setItem('loggedUser', this.loggedUser);\n         localStorage.setItem('isloggedIn', String(this.isloggedIn));\n       }\n     });\n   return validUser;\n }\n */\n\n  isAdmin(): Boolean {\n    if (!this.roles)\n      return false;\n    return this.roles.indexOf('ADMIN') >= 0;\n  }\n \n\n  setLoggedUserFromLocalStorage(login: string) {\n    this.loggedUser = login;\n    this.isloggedIn = true;\n    //this.getUserRoles(login);\n  }\n\n  /*\n  getUserRoles(username: string) {\n    this.users.forEach((curUser) => {\n      if (curUser.username == username) {\n        this.roles = curUser.roles;\n      }\n    });\n}\n*/\n\n}\n"],"mappings":"AAIA,SAASA,gBAAgB,QAAQ,oBAAoB;;;;AAKrD,OAAM,MAAOC,WAAW;EAetBC,YAAoBC,MAAc,EAAUC,IAAgB;IAAxC,KAAAD,MAAM,GAANA,MAAM;IAAkB,KAAAC,IAAI,GAAJA,IAAI;IAbhD,KAAAC,MAAM,GAAW,6BAA6B;IAEtC,KAAAC,MAAM,GAAG,IAAIN,gBAAgB,EAAE;IAQhC,KAAAO,UAAU,GAAY,KAAK;IAIhC,IAAI,CAACC,SAAS,EAAE;EAClB;EAEAC,KAAKA,CAACC,IAAU;IACd,OAAO,IAAI,CAACN,IAAI,CAACO,IAAI,CAAO,IAAI,CAACN,MAAM,GAAG,QAAQ,EAAEK,IAAI,EAAE;MAAEE,OAAO,EAAE;IAAU,CAAE,CAAC;EACpF;EACAC,SAASA,CAACC,GAAW;IAEnBC,YAAY,CAACC,OAAO,CAAC,KAAK,EAAEF,GAAG,CAAC;IAChC,IAAI,CAACG,KAAK,GAAGH,GAAG;IAChB,IAAI,CAACP,UAAU,GAAG,IAAI;EACxB;EAEAW,SAASA,CAAA;IACP,IAAI,IAAI,CAACD,KAAK,IAAIE,SAAS,EACzB;IACF,MAAMC,YAAY,GAAG,IAAI,CAACd,MAAM,CAACe,WAAW,CAAC,IAAI,CAACJ,KAAK,CAAC;IACxD,IAAI,CAACK,KAAK,GAAGF,YAAY,CAACE,KAAK;IAC/BC,OAAO,CAACC,GAAG,CAAC,SAAS,GAAC,IAAI,CAACF,KAAK,CAAC;IACjC,IAAI,CAACG,UAAU,GAAGL,YAAY,CAACM,GAAG;EACpC;EAEAC,QAAQA,CAAA;IACN,OAAO,IAAI,CAACV,KAAK;EACnB;EAEAW,MAAMA,CAAA;IACJ,IAAI,CAACH,UAAU,GAAGN,SAAU;IAC5B,IAAI,CAACG,KAAK,GAAGH,SAAU;IACvB,IAAI,CAACF,KAAK,GAAGE,SAAU;IACvB,IAAI,CAACZ,UAAU,GAAG,KAAK;IACvBQ,YAAY,CAACc,UAAU,CAAC,KAAK,CAAC;IAC9B,IAAI,CAAC1B,MAAM,CAAC2B,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;EAEAtB,SAASA,CAAA;IACP,IAAI,CAACS,KAAK,GAAGF,YAAY,CAACgB,OAAO,CAAC,KAAK,CAAE;IACzC,IAAI,CAACb,SAAS,EAAE;EAClB;EACAc,cAAcA,CAAA;IACZ,OAAO,IAAI,CAAC1B,MAAM,CAAC0B,cAAc,CAAC,IAAI,CAACf,KAAK,CAAC;EAC/C;EAEA;;;;;;;;;;;;;;;;EAiBAgB,OAAOA,CAAA;IACL,IAAI,CAAC,IAAI,CAACX,KAAK,EACb,OAAO,KAAK;IACd,OAAO,IAAI,CAACA,KAAK,CAACY,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC;EACzC;EAGAC,6BAA6BA,CAAC1B,KAAa;IACzC,IAAI,CAACgB,UAAU,GAAGhB,KAAK;IACvB,IAAI,CAACF,UAAU,GAAG,IAAI;IACtB;EACF;EAAC,QAAA6B,CAAA,G;qBAvFUnC,WAAW,EAAAoC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,MAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,UAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAX1C,WAAW;IAAA2C,OAAA,EAAX3C,WAAW,CAAA4C,IAAA;IAAAC,UAAA,EAFV;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}